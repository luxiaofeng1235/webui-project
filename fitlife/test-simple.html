<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•æµ‹è¯• - FitLife</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: bold;
            margin: 5px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #e55a2b; }
        #console {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            height: 150px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>FitLife ç®€å•æµ‹è¯•</h1>
    
    <div class="test-item">
        <h3>ğŸ“ æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥</h3>
        <div id="file-status" class="status info">æ£€æŸ¥ä¸­...</div>
        <button onclick="checkFiles()">æ£€æŸ¥æ–‡ä»¶</button>
    </div>
    
    <div class="test-item">
        <h3>ğŸ–¼ï¸ å›¾ç‰‡èµ„æºæ£€æŸ¥</h3>
        <div id="image-status" class="status info">æ£€æŸ¥ä¸­...</div>
        <button onclick="checkImages()">æ£€æŸ¥å›¾ç‰‡</button>
    </div>
    
    <div class="test-item">
        <h3>ğŸ”§ JavaScript å‡½æ•°æ£€æŸ¥</h3>
        <div id="js-status" class="status info">æ£€æŸ¥ä¸­...</div>
        <button onclick="checkJavaScript()">æ£€æŸ¥å‡½æ•°</button>
    </div>

    <div class="test-item">
        <h3>ğŸš« æ‡’åŠ è½½ç¦ç”¨æ£€æŸ¥</h3>
        <div id="lazy-status" class="status info">æ£€æŸ¥ä¸­...</div>
        <button onclick="checkLazyLoading()">æ£€æŸ¥æ‡’åŠ è½½</button>
    </div>
    
    <div class="test-item">
        <h3>ğŸ“ æ§åˆ¶å°è¾“å‡º</h3>
        <div id="console"></div>
        <button onclick="clearConsole()">æ¸…ç©º</button>
    </div>

    <script>
        // æ§åˆ¶å°é‡å®šå‘
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const timestamp = new Date().toLocaleTimeString();
            consoleDiv.innerHTML += `<div style="color: #0f0">[${timestamp}] ${args.join(' ')}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            const timestamp = new Date().toLocaleTimeString();
            consoleDiv.innerHTML += `<div style="color: #f00">[${timestamp}] ERROR: ${args.join(' ')}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        function clearConsole() {
            consoleDiv.innerHTML = '';
        }
        
        // æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§
        async function checkFiles() {
            console.log('å¼€å§‹æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§...');
            const status = document.getElementById('file-status');
            
            const files = [
                'js/modules/trainers.js',
                'js/modules/avatar-manager.js',
                'js/modules/user-manager.js',
                'avatar-preview-fix.js',
                'trainers-fix.js'
            ];
            
            let existingFiles = 0;
            
            for (const file of files) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        console.log(`âœ… ${file} å­˜åœ¨`);
                        existingFiles++;
                    } else {
                        console.error(`âŒ ${file} ä¸å­˜åœ¨ (${response.status})`);
                    }
                } catch (error) {
                    console.error(`âŒ ${file} æ£€æŸ¥å¤±è´¥: ${error.message}`);
                }
            }
            
            if (existingFiles === files.length) {
                status.className = 'status success';
                status.textContent = `âœ… æ‰€æœ‰æ–‡ä»¶å­˜åœ¨ (${existingFiles}/${files.length})`;
            } else {
                status.className = 'status error';
                status.textContent = `âŒ éƒ¨åˆ†æ–‡ä»¶ç¼ºå¤± (${existingFiles}/${files.length})`;
            }
        }
        
        // æ£€æŸ¥å›¾ç‰‡èµ„æº
        async function checkImages() {
            console.log('å¼€å§‹æ£€æŸ¥å›¾ç‰‡èµ„æº...');
            const status = document.getElementById('image-status');
            
            const images = [
                'images/hero-1.jpg',
                'images/trainer-1.jpg',
                'images/trainer-2.jpg',
                'images/pexels-photo-1552242.webp'
            ];
            
            let loadedImages = 0;
            
            for (const imagePath of images) {
                try {
                    const img = new Image();
                    await new Promise((resolve, reject) => {
                        img.onload = () => {
                            console.log(`âœ… ${imagePath} åŠ è½½æˆåŠŸ`);
                            loadedImages++;
                            resolve();
                        };
                        img.onerror = () => {
                            console.error(`âŒ ${imagePath} åŠ è½½å¤±è´¥`);
                            reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));
                        };
                        img.src = imagePath;
                    });
                } catch (error) {
                    console.error(`âŒ ${imagePath} æ£€æŸ¥å¤±è´¥`);
                }
            }
            
            if (loadedImages === images.length) {
                status.className = 'status success';
                status.textContent = `âœ… æ‰€æœ‰å›¾ç‰‡å¯ç”¨ (${loadedImages}/${images.length})`;
            } else {
                status.className = 'status error';
                status.textContent = `âŒ éƒ¨åˆ†å›¾ç‰‡ä¸å¯ç”¨ (${loadedImages}/${images.length})`;
            }
        }
        
        // æ£€æŸ¥æ‡’åŠ è½½ç¦ç”¨çŠ¶æ€
        function checkLazyLoading() {
            console.log('å¼€å§‹æ£€æŸ¥æ‡’åŠ è½½ç¦ç”¨çŠ¶æ€...');
            const status = document.getElementById('lazy-status');

            try {
                // æ£€æŸ¥æ‡’åŠ è½½å›¾ç‰‡
                const lazyImages = document.querySelectorAll('img[data-src], img[loading="lazy"]');
                const lazyClasses = document.querySelectorAll('img.lazy, img.lazyload, img.lazy-load');

                console.log(`å‘ç° ${lazyImages.length} ä¸ªæ‡’åŠ è½½å±æ€§å›¾ç‰‡`);
                console.log(`å‘ç° ${lazyClasses.length} ä¸ªæ‡’åŠ è½½ç±»å›¾ç‰‡`);

                // æ£€æŸ¥ç¦ç”¨å‡½æ•°
                const hasDisableFunction = typeof window.disableLazyLoading === 'function';
                console.log(`ç¦ç”¨æ‡’åŠ è½½å‡½æ•°å­˜åœ¨: ${hasDisableFunction}`);

                if (lazyImages.length === 0 && lazyClasses.length === 0 && hasDisableFunction) {
                    status.className = 'status success';
                    status.textContent = 'âœ… æ‡’åŠ è½½å·²å®Œå…¨ç¦ç”¨';
                } else if (hasDisableFunction) {
                    status.className = 'status info';
                    status.textContent = `âš ï¸ å‘ç° ${lazyImages.length + lazyClasses.length} ä¸ªæ‡’åŠ è½½å›¾ç‰‡ï¼Œä½†ç¦ç”¨å‡½æ•°å­˜åœ¨`;
                } else {
                    status.className = 'status error';
                    status.textContent = `âŒ æ‡’åŠ è½½æœªå®Œå…¨ç¦ç”¨ (${lazyImages.length + lazyClasses.length} ä¸ªå›¾ç‰‡)`;
                }

                // å¦‚æœæœ‰æ‡’åŠ è½½å›¾ç‰‡ï¼Œå°è¯•æ‰‹åŠ¨ç¦ç”¨
                if ((lazyImages.length > 0 || lazyClasses.length > 0) && hasDisableFunction) {
                    console.log('å°è¯•æ‰‹åŠ¨ç¦ç”¨æ‡’åŠ è½½...');
                    window.disableLazyLoading();

                    setTimeout(() => {
                        checkLazyLoading(); // é‡æ–°æ£€æŸ¥
                    }, 1000);
                }

            } catch (error) {
                console.error('æ‡’åŠ è½½æ£€æŸ¥å¤±è´¥:', error);
                status.className = 'status error';
                status.textContent = `âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`;
            }
        }

        // æ£€æŸ¥JavaScriptå‡½æ•°
        function checkJavaScript() {
            console.log('å¼€å§‹æ£€æŸ¥JavaScriptå‡½æ•°...');
            const status = document.getElementById('js-status');
            
            const functions = [
                'showTrainerDetail',
                'closeModal',
                'openAvatarUploadModal',
                'updateAvatarDisplay'
            ];
            
            let availableFunctions = 0;
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    console.log(`âœ… ${funcName} å‡½æ•°å¯ç”¨`);
                    availableFunctions++;
                } else {
                    console.error(`âŒ ${funcName} å‡½æ•°ä¸å¯ç”¨`);
                }
            });
            
            // æ£€æŸ¥æ¨¡å—æ˜¯å¦å­˜åœ¨
            const modules = ['trainerManager', 'avatarManager', 'authCore'];
            modules.forEach(moduleName => {
                if (window[moduleName]) {
                    console.log(`âœ… ${moduleName} æ¨¡å—å­˜åœ¨`);
                } else {
                    console.error(`âŒ ${moduleName} æ¨¡å—ä¸å­˜åœ¨`);
                }
            });
            
            if (availableFunctions >= functions.length / 2) {
                status.className = 'status success';
                status.textContent = `âœ… å¤§éƒ¨åˆ†å‡½æ•°å¯ç”¨ (${availableFunctions}/${functions.length})`;
            } else {
                status.className = 'status error';
                status.textContent = `âŒ å¤šæ•°å‡½æ•°ä¸å¯ç”¨ (${availableFunctions}/${functions.length})`;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', function() {
            console.log('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
            setTimeout(() => {
                checkFiles();
                setTimeout(() => {
                    checkImages();
                    setTimeout(() => {
                        checkJavaScript();
                        setTimeout(() => {
                            checkLazyLoading();
                        }, 1000);
                    }, 1000);
                }, 1000);
            }, 500);
        });
    </script>
</body>
</html>
