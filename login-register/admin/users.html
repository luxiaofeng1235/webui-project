<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·ç®¡ç† - é¤é¥®ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/admin/admin-common.css">
</head>
<body>
    <script src="../js/admin-layout.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                initUsersPage();
            }, 100);
        });

        async function initUsersPage() {
            adminLayout.setPageTitle('ç”¨æˆ·ç®¡ç†');
            adminLayout.showLoading();
            
            try {
                const users = await loadUsers();
                renderUsersPage(users);
            } catch (error) {
                adminLayout.showError('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥');
            }
        }

        async function loadUsers() {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve([
                        { id: 1, username: 'admin', email: 'admin@restaurant.com', role: 'admin', status: 'active', lastLogin: '2024-01-08 14:30', createTime: '2024-01-01' },
                        { id: 2, username: 'manager', email: 'manager@restaurant.com', role: 'manager', status: 'active', lastLogin: '2024-01-08 13:45', createTime: '2024-01-02' },
                        { id: 3, username: 'waiter1', email: 'waiter1@restaurant.com', role: 'waiter', status: 'active', lastLogin: '2024-01-08 12:20', createTime: '2024-01-03' },
                        { id: 4, username: 'chef1', email: 'chef1@restaurant.com', role: 'chef', status: 'active', lastLogin: '2024-01-08 11:15', createTime: '2024-01-04' },
                        { id: 5, username: 'cashier1', email: 'cashier1@restaurant.com', role: 'cashier', status: 'inactive', lastLogin: '2024-01-07 18:00', createTime: '2024-01-05' }
                    ]);
                }, 800);
            });
        }

        function renderUsersPage(users) {
            const content = \`
                <div class="admin-content-card">
                    <div class="admin-content-card-header">
                        <h2 class="admin-content-card-title">ğŸ‘¤ ç”¨æˆ·ç®¡ç†</h2>
                    </div>
                    <div class="admin-content-card-body">
                        <div class="admin-stats-grid" style="margin-bottom: 30px;">
                            <div class="admin-stat-card primary">
                                <h3 class="admin-stat-title">æ€»ç”¨æˆ·æ•°</h3>
                                <div class="admin-stat-number">\${users.length}</div>
                            </div>
                            <div class="admin-stat-card success">
                                <h3 class="admin-stat-title">æ´»è·ƒç”¨æˆ·</h3>
                                <div class="admin-stat-number">\${users.filter(u => u.status === 'active').length}</div>
                            </div>
                            <div class="admin-stat-card warning">
                                <h3 class="admin-stat-title">ç®¡ç†å‘˜</h3>
                                <div class="admin-stat-number">\${users.filter(u => u.role === 'admin').length}</div>
                            </div>
                            <div class="admin-stat-card info">
                                <h3 class="admin-stat-title">ä»Šæ—¥ç™»å½•</h3>
                                <div class="admin-stat-number">\${users.filter(u => u.lastLogin.includes('2024-01-08')).length}</div>
                            </div>
                        </div>

                        <div class="admin-toolbar">
                            <div class="admin-toolbar-left">
                                <div class="admin-search-box">
                                    <span class="admin-search-icon">ğŸ”</span>
                                    <input class="admin-search-input" type="text" placeholder="æœç´¢ç”¨æˆ·åæˆ–é‚®ç®±...">
                                </div>
                                <div class="admin-filters">
                                    <select class="admin-filter-select">
                                        <option value="">å…¨éƒ¨è§’è‰²</option>
                                        <option value="admin">ç®¡ç†å‘˜</option>
                                        <option value="manager">ç»ç†</option>
                                        <option value="waiter">æœåŠ¡å‘˜</option>
                                        <option value="chef">å¨å¸ˆ</option>
                                        <option value="cashier">æ”¶é“¶å‘˜</option>
                                    </select>
                                    <select class="admin-filter-select">
                                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                        <option value="active">æ´»è·ƒ</option>
                                        <option value="inactive">ç¦ç”¨</option>
                                    </select>
                                </div>
                            </div>
                            <div class="admin-toolbar-right">
                                <button class="btn btn-success" onclick="addUser()">â• æ·»åŠ ç”¨æˆ·</button>
                                <button class="btn btn-primary" onclick="exportUsers()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                            </div>
                        </div>

                        <table class="admin-data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ç”¨æˆ·å</th>
                                    <th>é‚®ç®±</th>
                                    <th>è§’è‰²</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æœ€åç™»å½•</th>
                                    <th>åˆ›å»ºæ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                \${users.map(user => \\\`
                                    <tr>
                                        <td><strong>#\\\${user.id}</strong></td>
                                        <td><strong>\\\${user.username}</strong></td>
                                        <td>\\\${user.email}</td>
                                        <td>
                                            \\\${getRoleBadge(user.role)}
                                        </td>
                                        <td>
                                            \\\${user.status === 'active' 
                                                ? '<span class="badge badge-success">æ´»è·ƒ</span>' 
                                                : '<span class="badge badge-secondary">ç¦ç”¨</span>'
                                            }
                                        </td>
                                        <td>\\\${user.lastLogin}</td>
                                        <td>\\\${user.createTime}</td>
                                        <td>
                                            <div class="admin-action-buttons">
                                                <button class="admin-action-btn primary" onclick="editUser(\\\${user.id})">ç¼–è¾‘</button>
                                                <button class="admin-action-btn \\\${user.status === 'active' ? 'warning' : 'success'}" 
                                                        onclick="toggleUserStatus(\\\${user.id}, '\\\${user.status}')">
                                                    \\\${user.status === 'active' ? 'ç¦ç”¨' : 'å¯ç”¨'}
                                                </button>
                                                \\\${user.role !== 'admin' ? '<button class="admin-action-btn danger" onclick="deleteUser(' + user.id + ')">åˆ é™¤</button>' : ''}
                                            </div>
                                        </td>
                                    </tr>
                                \\\`).join('')}
                            </tbody>
                        </table>

                        <div class="admin-pagination">
                            <span class="admin-pagination-info">æ˜¾ç¤º 1-\${users.length} æ¡ï¼Œå…± \${users.length} æ¡è®°å½•</span>
                            <button class="admin-pagination-btn" disabled>ä¸Šä¸€é¡µ</button>
                            <button class="admin-pagination-btn active">1</button>
                            <button class="admin-pagination-btn" disabled>ä¸‹ä¸€é¡µ</button>
                        </div>
                    </div>
                </div>
            \`;
            
            adminLayout.setPageContent(content);
        }

        function getRoleBadge(role) {
            const roleMap = {
                'admin': '<span class="badge badge-danger">ç®¡ç†å‘˜</span>',
                'manager': '<span class="badge badge-warning">ç»ç†</span>',
                'waiter': '<span class="badge badge-info">æœåŠ¡å‘˜</span>',
                'chef': '<span class="badge badge-success">å¨å¸ˆ</span>',
                'cashier': '<span class="badge badge-primary">æ”¶é“¶å‘˜</span>'
            };
            return roleMap[role] || '<span class="badge badge-secondary">æœªçŸ¥</span>';
        }

        function addUser() {
            alert('æ·»åŠ ç”¨æˆ·åŠŸèƒ½');
        }

        function editUser(id) {
            alert(\`ç¼–è¾‘ç”¨æˆ· \${id}\`);
        }

        function toggleUserStatus(id, currentStatus) {
            const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
            const action = newStatus === 'active' ? 'å¯ç”¨' : 'ç¦ç”¨';
            
            if (confirm(\`ç¡®å®šè¦\${action}è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ\`)) {
                alert(\`ç”¨æˆ· \${id} å·²\${action}\`);
                initUsersPage();
            }
        }

        function deleteUser(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                alert(\`ç”¨æˆ· \${id} å·²åˆ é™¤\`);
                initUsersPage();
            }
        }

        function exportUsers() {
            alert('å¯¼å‡ºç”¨æˆ·æ•°æ®åŠŸèƒ½');
        }
    </script>
</body>
</html>
