<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡¾å®¢ç®¡ç† - é¤é¥®ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/admin/admin-common.css">
</head>
<body>
    <script src="../js/admin-layout.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/admin-dialog.js"></script>
    <script src="../js/admin-customers.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                initCustomersPage();
            }, 100);
        });

        async function initCustomersPage() {
            adminLayout.setPageTitle('é¡¾å®¢ç®¡ç†');
            adminLayout.showLoading();

            try {
                const customers = await loadCustomers();
                renderCustomersPage(customers);
            } catch (error) {
                adminLayout.showError('åŠ è½½é¡¾å®¢æ•°æ®å¤±è´¥');
            }
        }

        async function loadCustomers() {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve([
                        {
                            id: 1,
                            username: 'customer001',
                            nickname: 'ç¾é£Ÿçˆ±å¥½è€…',
                            phone: '13800138001',
                            email: 'customer001@example.com',
                            gender: 1,
                            points_balance: 150.50,
                            status: 1,
                            created_at: '2025-06-01 10:00:00',
                            avatar_url: ''
                        },
                        {
                            id: 2,
                            username: 'customer002',
                            nickname: 'å¼ ä¸‰',
                            phone: '13800138002',
                            email: 'zhangsan@example.com',
                            gender: 1,
                            points_balance: 280.00,
                            status: 1,
                            created_at: '2025-06-15 14:30:00',
                            avatar_url: ''
                        },
                        {
                            id: 3,
                            username: 'customer003',
                            nickname: 'æå°å§',
                            phone: '13800138003',
                            email: 'lixiaojie@example.com',
                            gender: 2,
                            points_balance: 95.20,
                            status: 1,
                            created_at: '2025-07-01 09:15:00',
                            avatar_url: ''
                        }
                    ]);
                }, 800);
            });
        }

        function renderCustomersPage(customers) {
            const content = \`
                <div class="admin-content-card">
                    <div class="admin-content-card-header">
                        <h2 class="admin-content-card-title">ğŸ‘¥ é¡¾å®¢ç®¡ç†</h2>
                    </div>
                    <div class="admin-content-card-body">
                        <div class="admin-stats-grid" style="margin-bottom: 30px;">
                            <div class="admin-stat-card primary">
                                <h3 class="admin-stat-title">æ€»é¡¾å®¢æ•°</h3>
                                <div class="admin-stat-number">\${customers.length}</div>
                            </div>
                            <div class="admin-stat-card success">
                                <h3 class="admin-stat-title">æ­£å¸¸é¡¾å®¢</h3>
                                <div class="admin-stat-number">\${customers.filter(c => c.status === 1).length}</div>
                            </div>
                            <div class="admin-stat-card warning">
                                <h3 class="admin-stat-title">ç”·æ€§é¡¾å®¢</h3>
                                <div class="admin-stat-number">\${customers.filter(c => c.gender === 1).length}</div>
                            </div>
                            <div class="admin-stat-card info">
                                <h3 class="admin-stat-title">æ€»ç§¯åˆ†</h3>
                                <div class="admin-stat-number">\${customers.reduce((sum, c) => sum + (c.points_balance || 0), 0).toFixed(2)}</div>
                            </div>
                        </div>

                        <div class="admin-toolbar">
                            <div class="admin-toolbar-left">
                                <div class="admin-search-box">
                                    <span class="admin-search-icon">ğŸ”</span>
                                    <input class="admin-search-input" type="text" placeholder="æœç´¢é¡¾å®¢å§“åæˆ–æ‰‹æœºå·...">
                                </div>
                                <div class="admin-filters">
                                    <select class="admin-filter-select">
                                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                                        <option value="1">æ­£å¸¸</option>
                                        <option value="0">é”å®š</option>
                                    </select>
                                </div>
                            </div>
                            <div class="admin-toolbar-right">
                                <button class="btn btn-primary" onclick="exportCustomers()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                            </div>
                        </div>

                        <table class="admin-data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>é¡¾å®¢ä¿¡æ¯</th>
                                    <th>è”ç³»æ–¹å¼</th>
                                    <th>æ€§åˆ«</th>
                                    <th>ç§¯åˆ†ä½™é¢</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æ³¨å†Œæ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="customers">
                                <!-- é¡¾å®¢æ•°æ®å°†é€šè¿‡ customerManager.renderCustomers() æ¸²æŸ“ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            \`;
            
            adminLayout.setPageContent(content);
        }

        function addCustomer() {
            alert('æ·»åŠ å®¢æˆ·åŠŸèƒ½');
        }

        function viewCustomer(id) {
            alert(\`æŸ¥çœ‹å®¢æˆ· \${id} è¯¦æƒ…\`);
        }

        function editCustomer(id) {
            alert(\`ç¼–è¾‘å®¢æˆ· \${id}\`);
        }

        function exportCustomers() {
            alert('å¯¼å‡ºå®¢æˆ·æ•°æ®åŠŸèƒ½');
        }
    </script>
</body>
</html>
